{% extends 'catalog/base.html' %}

{% block title %}Партия #{{ batch.id }}{% endblock %}

{% block content %}
  <h1>Партия #{{ batch.id }}</h1>
  <p>Менеджер: {{ batch.manager.username }}</p>
  <p>Создана: {{ batch.created_at|date:"d.m.Y H:i" }}</p>

  <div class="mb-4 d-flex gap-3">
    <a href="{% url 'batch_add_item' batch.id %}" class="btn btn-success">Добавить товар</a>
    <a href="{% url 'batch_delete' batch.id %}" class="btn btn-danger">Удалить всю партию</a>
  </div>

  {% if items %}
    <table class="table">
      <thead>
        <tr>
          <th>Товар</th>
          <th>Количество</th>
          <th>Цена за единицу</th>
          <th>Скидка, %</th>
          <th>Итого</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td>{{ item.cheese.name }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.unit_price }} ₽</td>
            <td>{{ item.discount_percent }}%</td>
            <td>{{ item.total_price }} ₽</td>
            <td>
              <a href="{% url 'batch_item_edit' item.id %}" class="btn btn-sm btn-outline-primary">Редактировать</a>
              <a href="{% url 'batch_item_delete' item.id %}" class="btn btn-sm btn-outline-danger ms-1">Удалить</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Общая базовая сумма (без скидок):</strong> {{ batch.total_base_price }} ₽</p>
    <h4>Итоговая сумма с учётом скидок: {{ batch.total_price }} ₽</h4>
    <p><strong>Общая скидка по товарам:</strong> {{ batch.total_discount_percent }} %</p>
  {% else %}
    <p>В партии пока нет товаров.</p>
  {% endif %}

  <a href="{% url 'batch_list' %}" class="btn btn-secondary mt-3">← Назад к партиям</a>
{% endblock %}
